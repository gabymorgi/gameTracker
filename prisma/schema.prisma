generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model ScoreExtras {
  id   String @id @default(uuid())
  bias Int
  info String

  scoreId String
  score   Score  @relation(fields: [scoreId], references: [id])
}

model Score {
  id        String        @id @default(uuid())
  controls  Int?
  music     Int?
  lore      Int?
  bosses    Int?
  mechanics Int?
  graphics  Int?
  content   Int?
  finalMark Int
  extras    ScoreExtras[]
  game      Game?
}

model Game {
  id                   String      @id @default(uuid())
  name                 String
  playedTime           Int
  extraPlayedTime      Int?
  imageUrl             String
  appid                Int?        @unique
  start                Int
  end                  Int
  obtainedAchievements Int
  totalAchievements    Int
  gameTags             GameTag[]
  changeLogs           ChangeLog[]
  platform             Platform    @default(PC)

  score   Score?  @relation(fields: [scoreId], references: [id])
  scoreId String? @unique
  state   State   @relation(fields: [stateId], references: [id])
  stateId String
}

model GameTag {
  game   Game   @relation(fields: [gameId], references: [id], onDelete: Cascade)
  gameId String
  tag    Tags   @relation(fields: [tagId], references: [id])
  tagId  String

  @@id([gameId, tagId])
}

model State {
  id         String      @id @default(uuid())
  hue        Int
  games      Game[]
  changeLogs ChangeLog[]
}

model Tags {
  id       String    @id @default(uuid())
  hue      Int
  gameTags GameTag[]
}

model ChangeLog {
  id           String @id @default(uuid())
  createdAt    Int
  hours        Int
  achievements Int
  state        State  @relation(fields: [stateId], references: [id])
  stateId      String
  game         Game   @relation(fields: [gameId], references: [id], onDelete: Cascade)
  gameId       String
}

model Admin {
  id       String @id @default(uuid())
  email    String @unique
  password String
}

model Word {
  id                        String       @id @default(uuid())
  value                     String       @unique
  definition                String?
  pronunciation             String?
  wordPhrases               WordPhrase[]
  priority                  Int          @default(0)
  practiceWord              Float        @default(0)
  practicePhrase            Float        @default(0)
  practicePronunciation     Float        @default(0)
  practiceListening         Float        @default(0)
  practiceTranslation       Float        @default(0)
  nextPractice              DateTime     @default(now())
}

model Phrase {
  id          String       @id @default(uuid())
  content     String
  translation String?
  wordPhrases WordPhrase[]
}

model WordPhrase {
  wordId   String
  phraseId String
  word     Word   @relation(fields: [wordId], references: [id])
  phrase   Phrase @relation(fields: [phraseId], references: [id])

  @@id([wordId, phraseId])
}

enum Platform {
  NES
  SEGA
  PS1
  PS2
  SNES
  PC
  NDS
  GBA
  WII
  ANDROID
  FLASH
}
